{% extends 'shop/base.html' %}
{% block title %}Products | E-Shop{% endblock %}
{% block content %}
<h2 class="mb-3">Products</h2>
<form method="get" class="row g-2 mb-4">
  <div class="col-md-3"><input name="search" value="{{ request.GET.search }}" class="form-control" placeholder="Search"></div>
  <div class="col-md-2"><input type="number" step="0.01" name="min_price" value="{{ request.GET.min_price }}" class="form-control" placeholder="Min Price"></div>
  <div class="col-md-2"><input type="number" step="0.01" name="max_price" value="{{ request.GET.max_price }}" class="form-control" placeholder="Max Price"></div>
  <div class="col-md-2"><select name="rating" class="form-select">
      <option value="">Min Rating</option>
      {% for r in '12345' %}
        <option value="{{ forloop.counter }}" {% if request.GET.rating == forloop.counter|stringformat:'s' %}selected{% endif %}>{{ forloop.counter }}+</option>
      {% endfor %}
  </select></div>
  <div class="col-md-2 d-grid"><button class="btn btn-primary">Filter</button></div>
</form>
<div class="row g-3">
  {% for product in products %}
  <div class="col-6 col-md-3">
    <div class="card h-100">
      {% if product.image %}<img src="{{ product.image.url }}" class="card-img-top" style="object-fit:cover;height:140px">{% endif %}
      <div class="card-body d-flex flex-column">
  <h6 class="fw-semibold mb-1"><a href="{% url 'shop:product_detail' product.slug %}">{{ product.name }}</a></h6>
        <div class="small text-muted mb-2">${{ product.price }} • {{ product.average_rating|floatformat:1 }}★</div>
        <span class="badge badge-impact align-self-start">{{ product.effective_carbon_kg }} kg CO₂e</span>
        <div class="mt-auto">
          <a href="{% url 'shop:product_detail' product.slug %}" class="btn btn-sm btn-primary mt-2 w-100">View</a>
        </div>
      </div>
    </div>
  </div>
  {% empty %}
  <p>No products found.</p>
  {% endfor %}
</div>
{% endblock %}
